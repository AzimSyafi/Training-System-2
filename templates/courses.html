{% extends "base.html" %}

{% block content %}
<div class="container mx-auto p-4">
  <h2 class="text-2xl font-bold mb-6 text-blue-900">Courses</h2>
  <div class="flex flex-row gap-8 justify-center">
    {% for course in course_progress %}
    <div class="max-w-md w-[350px] rounded-xl shadow-md overflow-hidden bg-white border border-gray-200 flex flex-col">
      <div class="h-24 bg-[url('/pattern.svg')] bg-cover bg-center"></div>
      <div class="p-4 flex flex-col flex-1">
        <h2 class="text-blue-700 font-semibold text-lg mb-4">
          {{ course.name }}
        </h2>
        <div class="flex items-center justify-between mb-4">
          <div style="width: 66.66%; background-color: #e5e7eb; border-radius: 9999px; height: 10px;">
            <div style="background-color: #3b82f6; height: 100%; border-radius: 9999px; width: {{ course.percent }}%; transition: width 0.5s;"></div>
          </div>
          <div class="ml-2 text-xs text-gray-600 whitespace-nowrap">{{ course.percent }}% complete</div>
        </div>
        <a href="/modules/{{ course.code }}" class="block w-full text-center border border-blue-700 bg-white text-blue-700 hover:bg-blue-700 hover:text-white font-semibold py-2 rounded-lg transition mb-2">Access Course</a>
        <button class="block w-full text-center border border-green-700 bg-green-700 text-white font-semibold py-2 rounded-lg transition mb-2 {% if course.percent < 100 %}opacity-50 cursor-not-allowed{% endif %}" onclick="if({{ course.percent }} === 100){completeCourse('{{ course.code }}')}" {% if course.percent < 100 %}disabled{% endif %}>Complete Course</button>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
<script>
function completeCourse(courseCode) {
  fetch('/api/complete_course', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ course_code: courseCode })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert('Course completed! Certificate issued and star rating updated.');
      location.reload();
    } else {
      alert('Error: ' + (data.message || 'Could not complete course.'));
    }
  });
}
</script>
{% endblock %}
