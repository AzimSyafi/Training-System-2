{% extends "base.html" %}
{% block title %}Progress Monitor{% endblock %}
{% block content %}
<div class="container-fluid py-4">
  <h2 class="mb-4"><i class="fas fa-chart-line"></i> Progress Monitoring</h2>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">{{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  {% set rows = course_progress_rows or [] %}
  {% if rows and rows|length > 0 %}
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th>User</th>
              <th>Course</th>
              <th>Agency</th>
              <th>Completed</th>
              <th>Progress</th>
              <th>Avg Score</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
            <tr>
              <td>{{ r.user_name }}</td>
              <td>{{ r.course_name }} <span class="badge bg-secondary">{{ r.course_code }}</span></td>
              <td>{{ r.agency_name }}</td>
              <td>{{ r.completed_modules }}/{{ r.total_modules }}</td>
              <td>
                <div class="progress" style="height: 20px;">
                  <div class="progress-bar {% if r.progress_pct >= 100 %}bg-success{% elif r.progress_pct >= 50 %}bg-primary{% else %}bg-warning text-dark{% endif %}" role="progressbar" style="width: {{ r.progress_pct }}%;" aria-valuenow="{{ r.progress_pct }}" aria-valuemin="0" aria-valuemax="100">{{ r.progress_pct }}%</div>
                </div>
              </td>
              <td>
                {% if r.avg_score is not none %}
                  <span class="fw-semibold {% if r.avg_score <= 50 %}text-danger{% elif r.avg_score > 75 %}text-success{% else %}text-primary{% endif %}">{{ r.avg_score }}</span>%
                {% else %}-{% endif %}
              </td>
              <td>
                {% if r.status == 'Completed' %}
                  <span class="badge bg-success">Completed</span>
                {% else %}
                  <span class="badge bg-warning text-dark">In Progress</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% else %}
    <div class="alert alert-info">No course progress records yet.</div>
  {% endif %}
</div>
{% endblock %}
