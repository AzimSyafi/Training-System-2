{% extends 'base.html' %}

{% block title %}Sign Up - Training System{% endblock %}

{% block content %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

  :root{
    --primary: #0d6efd;
    --bg-dark: #071428;
    --panel-radius: 12px;
    
    /* Hardcoding light-mode colors */
    --panel-bg: #ffffff;
    --panel-text: #0f1724;
    --input-bg: #fff;
    --input-border: #e6edf6;
    --muted-text: #6b7280;
    --label-text: #111827; /* Added this for labels */
  }

  /* Dark mode variables - will only affect page background */
  body.dark-mode,
  html.darkmode body {
    --bg-dark: #0f172a;
    
    /* Overridden by !important below */
    /*
    --panel-bg: #1e3a5f; 
    --panel-text: #f1f5f9;
    --input-bg: #0f172a;
    --input-border: #475569;
    --muted-text: #94a3b8;
    */
  }

  html, body {
    height: 100%;
    margin: 0;
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background-image: linear-gradient(180deg, rgba(6,20,40,0.85) 0%, rgba(8,28,48,0.85) 100%), url('https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070&auto=format&fit=crop');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    background-repeat: no-repeat;
    color: #eaf6ff;
    overflow-y: auto;
  }
  
  /* Hide scrollbars but allow scrolling */
  html::-webkit-scrollbar,
  body::-webkit-scrollbar {
    display: none;
  }
  
  html, body {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .split-root {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  /* Brand logo at top */
  .left-panel {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    margin-bottom: 20px;
  }

  .brand {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 8px;
  }

  .brand .title {
    font-weight: 800;
    letter-spacing: 1px;
    color: #e6f2ff;
    font-size: 2.25rem;
    line-height: 1;
  }

  .brand .brand-tagline {
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    font-size: 1.5rem;
    font-weight: 400;
    color: rgba(230,244,255,0.92);
    line-height: 1.05;
    margin: 0;
  }

  /* White form panel floating on background */
  .right-panel {
    width: 100%;
    max-width: 520px;
    background: #ffffff !important;
    color: #0f1724 !important;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 48px 36px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    border-radius: 20px;
  }
  
  /* Hide scrollbar on form panel */
  .right-panel::-webkit-scrollbar {
    display: none;
  }
  
  .right-panel {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .auth-card {
    width: 100%;
    max-width: 440px;
    border-radius: var(--panel-radius);
    padding: 28px;
    background: transparent;
  }

  .auth-card .card-title {
    font-size: 1.35rem;
    font-weight: 600;
    color: #111827 !important; /* CHANGED */
    margin-bottom: 6px;
  }

  .auth-card .card-sub {
    font-size: 0.95rem;
    color: #6b7280 !important; /* CHANGED */
    margin-bottom: 18px;
  }

  .form-label {
    color: var(--text-color) !important;
    font-weight: 500;
    margin-bottom: 8px;
  }

  .right-panel .form-label {
    color: var(--text-color) !important;
    font-weight: 500;
  }

  .auth-card .form-label {
    color: var(--text-color) !important;
    font-weight: 500;
  }

  label.form-label {
    color: var(--text-color) !important;
    font-weight: 500;
  }

  /* CHANGED: Targeting by ID for maximum specificity */
  .right-panel #full_name,
  .right-panel #email,
  .right-panel #password,
  .right-panel #ic_number,
  .right-panel #passport_number,
  .right-panel #country,
  .right-panel #agency_id {
    border-radius: 8px;
    padding: 10px 12px;
    border: 1.5px solid #e6edf6 !important;
    background: #ffffff !important;
    color: #111827 !important;
    font-weight: 400;
  }

  /* CHANGED: Targeting placeholders by ID */
  .right-panel #full_name::placeholder,
  .right-panel #email::placeholder,
  .right-panel #password::placeholder,
  .right-panel #ic_number::placeholder,
  .right-panel #passport_number::placeholder {
      color: #6b7280 !important;
      opacity: 1 !important;
  }

  /* CHANGED: Targeting focus by ID */
  .right-panel #full_name:focus,
  .right-panel #email:focus,
  .right-panel .form-check-label {
    color: var(--text-color) !important;
    font-weight: 400;
  }

  .auth-card .form-check-label {
    color: var(--text-color) !important;
    font-weight: 400;
  }

  label.form-check-label {
    color: var(--text-color) !important;
    font-weight: 400;
  }

  .right-panel #password:focus,
  .right-panel #ic_number:focus,
  .right-panel #passport_number:focus,
  .right-panel #country:focus,
  .right-panel #agency_id:focus {
    border-color: var(--primary) !important;
    background: #ffffff !important;
    box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
  }

  .form-check-label {
    color: var(--text-color) !important;
    font-weight: 400;
  }

  /* ADDED: Rules to force radio buttons to light mode */
  .right-panel .form-check-input {
    background-color: #ffffff !important;
    border: 1.5px solid #adb5bd !important;
  }

  .right-panel .form-check-input:focus {
    box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1) !important;
  }

  .right-panel .form-check-input:checked {
    background-color: var(--primary) !important;
    border-color: var(--primary) !important;
  }
  /* End of new radio button rules */

  .input-group .btn {
    border-radius: 0 8px 8px 0;
    border: 1.5px solid #e6edf6 !important; /* CHANGED */
    background: #ffffff !important; /* CHANGED */
    color: #111827 !important; /* CHANGED */
  }

  .btn-primary-custom {
    background: linear-gradient(90deg, var(--primary) 0%, #0960e6 100%);
    border: none;
    color: #fff;
    padding: 10px 14px;
    border-radius: 10px;
    font-weight: 600;
    width: 100%;
    box-shadow: 0 8px 22px rgba(13,110,253,0.18);
  }

  .muted-links {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 12px;
    font-size: 0.9rem;
    color: #6b7280 !important; /* CHANGED */
  }

  .muted-links a {
    color: var(--primary);
  }

  .right-footer {
    margin-top: 18px;
    text-align: center;
    font-size: 0.85rem;
    color: #6b7280 !important; /* CHANGED */
  }

  /* FINAL OVERRIDE: Ensure all labels use theme color - highest specificity */
  .split-root .right-panel .auth-card label,
  .split-root .right-panel .auth-card .form-label,
  .split-root .right-panel .auth-card .form-check-label,
  .split-root main.right-panel form label {
    color: var(--text-color) !important;
  }

  @media (max-width: 768px) {
    html, body {
      background-attachment: scroll;
    }

    .split-root {
      padding: 15px;
    }

    .left-panel {
      margin-bottom: 15px;
      padding: 15px;
    }

    .brand .title {
      font-size: 1.8rem;
    }

    .brand .brand-tagline {
      font-size: 1.2rem;
    }

    .right-panel {
      max-width: 100%;
      padding: 30px 24px;
      border-radius: 16px;
    }

    .auth-card {
      padding: 0;
      max-width: 100%;
    }

    .auth-card .card-title {
      font-size: 1.25rem;
    }

    .auth-card .card-sub {
      font-size: 0.875rem;
    }

    .form-label {
      font-size: 0.9rem;
      font-weight: 500;
    }

    .form-control, .form-select {
      font-size: 16px;
    }

    /* Radio buttons - reduce spacing on mobile */
    .form-check {
      margin-bottom: 0.25rem !important;
      padding-top: 0.25rem !important;
      padding-bottom: 0.25rem !important;
    }

    .form-check:last-child {
      margin-bottom: 0 !important;
    }

    .muted-links {
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
    }
  }

  @media (max-width: 480px) {
    .right-panel {
      padding: 24px 20px;
    }

    .auth-card .card-title {
      font-size: 1.15rem;
    }

    .brand .title {
      font-size: 1.5rem;
    }

    .brand .brand-tagline {
      font-size: 1rem;
    }

    .left-panel {
      padding: 10px;
    }
  }
</style>

<div class="split-root">
  <aside class="left-panel" aria-hidden="true">
    <div class="brand">
      <div class="title">SHAPADU SECURITY</div>
      <p class="brand-tagline">Create your Account</p>
    </div>
  </aside>

  <main class="right-panel">
    <div class="auth-card">
      <div class="card-title">Sign up with email</div>
      <div class="card-sub">Create an account to access security personnel training</div>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="POST" novalidate>
        <div class="mb-3">
          <label for="full_name" class="form-label">Full Name</label>
          <input type="text" class="form-control" id="full_name" name="full_name" required placeholder="Enter your full name">
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">Email Address</label>
          <input type="email" class="form-control" id="email" name="email" required placeholder="you@example.com">
        </div>

        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <input type="password" class="form-control" id="password" name="password" required placeholder="Enter a password">
        </div>

        <div class="mb-3">
          <label class="form-label">Citizenship</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="user_category" id="citizen" value="citizen" required onchange="toggleIdField()">
            <label class="form-check-label" for="citizen">Malaysian Citizen</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="user_category" id="foreigner" value="foreigner" required onchange="toggleIdField()">
            <label class="form-check-label" for="foreigner">Foreigner</label>
          </div>
        </div>

        <div class="mb-3" id="ic_field" style="display: none;">
          <label for="ic_number" class="form-label">IC Number</label>
          <input type="text" class="form-control" id="ic_number" name="ic_number" placeholder="e.g., 900101-10-1234">
        </div>

        <div class="mb-3" id="passport_field" style="display: none;">
          <label for="passport_number" class="form-label">Passport Number</label>
          <input type="text" class="form-control" id="passport_number" name="passport_number" placeholder="Enter passport number">
        </div>

        <div class="mb-3" id="country_field" style="display: none;">
          <label for="country" class="form-label">Country</label>
          <select class="form-select" id="country" name="country">
            <option value="" selected>Select country</option>
            <option>Afghanistan</option>
            <option>Armenia</option>
            <option>Azerbaijan</option>
            <option>Bahrain</option>
            <option>Bangladesh</option>
            <option>Bhutan</option>
            <option>Brunei</option>
            <option>Cambodia</option>
            <option>China</option>
            <option>Cyprus</option>
            <option>Georgia</option>
            <option>Hong Kong SAR</option>
            <option>India</option>
            <option>Indonesia</option>
            <option>Iran</option>
            <option>Iraq</option>
            <option>Japan</option>
            <option>Jordan</option>
            <option>Kazakhstan</option>
            <option>Kuwait</option>
            <option>Kyrgyzstan</option>
            <option>Laos</option>
            <option>Lebanon</option>
            <option>Malaysia</option>
            <option>Maldives</option>
            <option>Mongolia</option>
            <option>Myanmar</option>
            <option>Nepal</option>
            <option>North Korea</option>
            <option>Oman</option>
            <option>Pakistan</option>
            <option>Palestine</option>
            <option>Philippines</option>
            <option>Qatar</option>
            <option>Saudi Arabia</option>
            <option>Singapore</option>
            <option>South Korea</option>
            <option>Sri Lanka</option>
            <option>Syria</option>
            <option>Taiwan</option>
            <option>Tajikistan</option>
            <option>Thailand</option>
            <option>Timor-Leste</option>
            <option>Turkey</option>
            <option>Turkmenistan</option>
            <option>United Arab Emirates</option>
            <option>Uzbekistan</option>
            <option>Vietnam</option>
            <option>Yemen</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="agency_id" class="form-label">Select Agency</label>
          <select class="form-select" id="agency_id" name="agency_id" required>
            <option value="" disabled selected>Select your agency</option>
            <option value="none">None</option>
            {% if agencies %}
              {% for agency in agencies %}
                <option value="{{ agency.agency_id }}">{{ agency.agency_name }}</option>
              {% endfor %}
            {% else %}
              <option disabled>No agencies available</option>
            {% endif %}
          </select>
        </div>

        <div class="d-grid">
          <button type="submit" class="btn btn-primary btn-primary-custom">Create Account</button>
        </div>

        <div class="muted-links" style="margin-top:12px;">
          <div>Already have an account? <a href="{{ url_for('main.login') }}" class="link-primary">Login</a></div>
          <div><a href="{{ url_for('main.index') }}" class="text-muted">Back to Home</a></div>
        </div>

        <div class="right-footer">
          <div style="margin-top:8px;">&copy; 2025 SHAPADU SECURITY SDN BHD</div>
        </div>
      </form>
    </div>
  </main>
</div>

<script>
  function toggleIdField() {
    const userCategory = document.querySelector('input[name="user_category"]:checked');
    const icField = document.getElementById('ic_field');
    const passportField = document.getElementById('passport_field');
    const countryField = document.getElementById('country_field');
    const icInput = document.getElementById('ic_number');
    const passportInput = document.getElementById('passport_number');
    const countryInput = document.getElementById('country');
    const agencyInput = document.getElementById('agency_id');

    if (userCategory) {
      if (userCategory.value === 'citizen') {
        icField.style.display = 'block';
        passportField.style.display = 'none';
        countryField.style.display = 'none';
        if (icInput) icInput.required = true;
        if (passportInput) {
            passportInput.required = false;
            passportInput.value = ''; // Clear value
        }
        if (countryInput) {
            countryInput.required = false;
            countryInput.value = ''; // Clear value
        }
      } else if (userCategory.value === 'foreigner') {
        icField.style.display = 'none';
        passportField.style.display = 'block';
        countryField.style.display = 'block';
        if (icInput) {
            icInput.required = false;
            icInput.value = ''; // Clear value
        }
        if (passportInput) passportInput.required = true;
        if (countryInput) countryInput.required = true;
      }
    } else {
      icField.style.display = 'none';
      passportField.style.display = 'none';
      countryField.style.display = 'none';
      if (icInput) icInput.required = false;
      if (passportInput) passportInput.required = false;
      if (countryInput) countryInput.required = false;
    }
  }

  // Also clear fields when toggling
  document.querySelectorAll('input[name="user_category"]').forEach((elem) => {
      elem.addEventListener("change", toggleIdField);
  });

  window.addEventListener('DOMContentLoaded', toggleIdField);
</script>
{% endblock %}
